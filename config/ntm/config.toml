# NTM (Named Tmux Manager) Configuration
# https://github.com/Dicklesworthstone/ntm

# Base directory for projects
projects_base = "~/projects"

# UI Theme (mocha, macchiato, nord, latte, auto)
# theme = "auto"

# Path to command palette markdown file (optional)
# If set, loads palette commands from this file instead of [[palette]] entries below
# Searched automatically: ~/.config/ntm/command_palette.md, ./command_palette.md
# palette_file = "~/.config/ntm/command_palette.md"

# Palette state (favorites/pins)
# Managed by the command palette UI (ntm palette)
[palette_state]
# pinned = []
# favorites = []

[agents]
# Commands used to launch each agent type
# AGENT_NAME uses $TMUX_PANE (e.g., %1, %2) for unique multi-agent identity
# Note: tmux display-message doesn't work reliably at spawn time
claude = "AGENT_NAME=\"${TMUX_PANE:-cc_$$}\" NODE_OPTIONS=\"--max-old-space-size=32768\" ENABLE_BACKGROUND_TASKS=1 claude --dangerously-skip-permissions{{if .Model}} --model {{shellQuote .Model}}{{end}}{{if .SystemPromptFile}} --system-prompt-file {{shellQuote .SystemPromptFile}}{{end}}"
codex = "AGENT_NAME=\"${TMUX_PANE:-cod_$$}\" {{if .SystemPromptFile}}CODEX_SYSTEM_PROMPT=\"$(cat {{shellQuote .SystemPromptFile}})\" {{end}}codex --dangerously-bypass-approvals-and-sandbox -m {{shellQuote (.Model | default \"gpt-4\")}} -c model_reasoning_effort=\"high\" -c model_reasoning_summary_format=experimental --enable web_search_request"
gemini = "AGENT_NAME=\"${TMUX_PANE:-gmi_$$}\" gemini{{if .Model}} --model {{shellQuote .Model}}{{end}}{{if .SystemPromptFile}} --system-instruction-file {{shellQuote .SystemPromptFile}}{{end}} --yolo"

[tmux]
# Tmux-specific settings
default_panes = 10
palette_key = "F6"

[agent_mail]
# Agent Mail server settings for multi-agent coordination
# Environment variables: AGENT_MAIL_URL, AGENT_MAIL_TOKEN, AGENT_MAIL_ENABLED
enabled = false
url = "http://127.0.0.1:8765/mcp/"
# token = ""  # Or set AGENT_MAIL_TOKEN env var
auto_register = true
program_name = "ntm"

[models]
# Default models when no specifier given
default_claude = "claude-sonnet-4-20250514"
default_codex = "gpt-4"
default_gemini = "gemini-2.0-flash"

[models.claude]
# Claude model aliases (e.g., --cc=2:opus)
architect = "claude-opus-4-20250514"
fast = "claude-sonnet-4-20250514"
opus = "claude-opus-4-20250514"
sonnet = "claude-sonnet-4-20250514"
haiku = "claude-haiku-3-20240307"

[models.codex]
# Codex model aliases (e.g., --cod=2:max)
o1 = "o1"
turbo = "gpt-4-turbo"
max = "gpt-5.1-codex-max"
gpt4 = "gpt-4"

[models.gemini]
# Gemini model aliases (e.g., --gmi=1:flash)
pro = "gemini-pro"
flash = "gemini-2.0-flash"
ultra = "gemini-ultra"

[alerts]
# Alert system configuration for proactive problem detection
enabled = false
agent_stuck_minutes = 5    # Minutes without output before alerting
disk_low_threshold_gb = 5.0  # Minimum free disk space (GB)
mail_backlog_threshold = 10  # Unread messages before alerting
bead_stale_hours = 24       # Hours before in-progress bead is stale
resolved_prune_minutes = 60 # How long to keep resolved alerts

[checkpoints]
# Automatic checkpoint configuration for risky operations
enabled = false                    # Master toggle for auto-checkpoints
before_broadcast = true           # Auto-checkpoint before sending to all agents
before_add_agents = 3            # Auto-checkpoint when adding >= N agents (0 = disabled)
max_auto_checkpoints = 10        # Max auto-checkpoints per session (rotation)
scrollback_lines = 500           # Lines of scrollback to capture
include_git = true               # Capture git state in auto-checkpoints
auto_checkpoint_on_spawn = false   # Auto-checkpoint when spawning session

[notifications]
# Notification system for agent events (errors, crashes, rate limits)
enabled = false
events = ["agent.error", "agent.crashed"]  # Events to notify on

[notifications.desktop]
# Desktop notifications (macOS/Linux)
enabled = false
title = "NTM"  # Default notification title

[notifications.webhook]
# Webhook notifications (Slack, Discord, etc.)
enabled = false
# url = "https://hooks.slack.com/..."
method = "POST"
template = "{\"text\": \"NTM: {{.Type}} - {{.Message}}\"}"

[notifications.shell]
# Shell command notifications
enabled = false
# command = "~/bin/notify.sh"
pass_json = true  # Pass event as JSON to stdin

[notifications.log]
# Log file notifications
enabled = false
path = "~/.config/ntm/notifications.log"

[resilience]
# Agent auto-restart and recovery configuration
auto_restart = false           # Enable automatic agent restart on crash
max_restarts = 3            # Max restarts per agent before giving up
restart_delay_seconds = 30  # Seconds to wait before restarting
health_check_seconds = 10   # Seconds between health checks
notify_on_crash = true       # Send notification when agent crashes
notify_on_max_restarts = true # Notify when max restarts exceeded

[resilience.rate_limit]
# Rate limit detection configuration
detect = true   # Enable rate limit detection
notify = true   # Send notification on rate limit
# patterns = ["custom pattern"]  # Custom patterns (in addition to defaults)

[accounts]
# Multi-account management for quota rotation
state_file = "~/.config/ntm/account_state.json"            # Path to account state JSON
auto_rotate = true            # Auto-rotate when limit detected
reset_buffer_minutes = 15   # Minutes before reset to consider available

# [[accounts.claude]]
# email = "primary@gmail.com"
# alias = "main"
# priority = 1

[rotation]
# Account rotation and restart configuration
enabled = false               # Master toggle
prefer_restart = true        # Prefer restart over account switch
auto_open_browser = false     # Auto-open browser for auth
continuation_prompt = "Continue where you left off. Previous context: {{.Context}}"

[rotation.thresholds]
warning_percent = 80        # Show warning at this quota %
critical_percent = 95       # Consider limited at this %
restart_if_tokens_above = 100000  # Restart if tokens exceed this
restart_if_session_hours = 8   # Restart after N hours

[rotation.dashboard]
show_quota_bars = true       # Show quota bars in dashboard
show_account_status = true   # Show account status
show_reset_timers = true     # Show reset countdown

[scanner]
# UBS scanner configuration
# ubs_path = ""  # Auto-detect from PATH

[scanner.defaults]
timeout = "120s"
parallel = true
exclude = [ "vendor/**", "node_modules/**", ".git/**", "*.min.js", "*.min.css" ]

[cass]
# CASS (Coding Agent Session Search) configuration
enabled = false
timeout = 30
# binary_path = ""  # Auto-detect from PATH

[gemini_setup]
# Gemini CLI post-spawn setup configuration
# When enabled, NTM automatically selects the Pro model after spawning Gemini agents
auto_select_pro_model = true       # Auto-select Pro model (Gemini 3) on spawn
ready_timeout_seconds = 30       # Seconds to wait for Gemini CLI to be ready
model_select_timeout_seconds = 10 # Seconds to wait for model selection menu
verbose = false                     # Show debug output during setup

# Command Palette entries
# Add your own prompts here

# Analysis & Review
[[palette]]
key = "fresh_review"
label = "Fresh Review"
category = "Analysis & Review"
prompt = """
Great, now I want you to carefully read over all of the new code you just wrote and other existing code you just modified with "fresh eyes" looking super carefully for any obvious bugs, errors, problems, issues, confusion, etc. Carefully fix anything you uncover."""

[[palette]]
key = "check_other_agents_work"
label = "Check Other Agents Work"
category = "Analysis & Review"
prompt = """
Ok can you now turn your attention to reviewing the code written by your fellow agents and checking for any issues, bugs, errors, problems, inefficiencies, security problems, reliability issues, etc. and carefully diagnose their underlying root causes using first-principle analysis and then fix or revise them if necessary? Don't restrict yourself to the latest commits, cast a wider net and go super deep! Use ultrathink."""

[[palette]]
key = "randomly_inspect_code"
label = "Randomly Inspect Code"
category = "Analysis & Review"
prompt = """
I want you to sort of randomly explore the code files in this project, choosing code files to deeply investigate and understand and trace their functionality and execution flows through the related code files which they import or which they are imported by. Once you understand the purpose of the code in the larger context of the workflows, I want you to do a super careful, methodical, and critical check with "fresh eyes" to find any obvious bugs, problems, errors, issues, silly mistakes, etc. and then systematically and meticulously and intelligently correct them. Be sure to comply with ALL rules in AGENTS.md and ensure that any code you write or revise conforms to the best practice guides referenced in the AGENTS.md file."""

[[palette]]
key = "analyze_beads_and_allocate"
label = "Analyze Beads and Allocate"
category = "Analysis & Review"
prompt = """
Re-read AGENTS.md first. Then, can you try using bv to get some insights on what each agent should most usefully work on? Then share those insights with the other agents via agent mail and strongly suggest in your messages the optimal work for each one and explain how/why you came up with that using bv. Use ultrathink."""

[[palette]]
key = "check_orm_and_schemas"
label = "Check ORM and Schemas"
category = "Analysis & Review"
prompt = """
Now reread AGENTS.md, read your README.md, and then I want you to use ultrathink to super carefully and critically read the entire data ORM schema/models and look for any issues or problems, conceptual mistakes, logical errors, or anything that doesn't fit your understanding of the business strategy and accepted best practices for the design and architecture of databases for these sorts of ecommerce/saas projects/companies."""

[[palette]]
key = "scrutinize_and_improve_workflow_and_ui"
label = "Scrutinize and Improve Workflow and UI"
category = "Analysis & Review"
prompt = """
Great, now I want you to super carefully scrutinize every aspect of the application workflow and implementation and look for things that just seem sub-optimal or even wrong/mistaken to you, things that could very obviously be improved from a user-friendliness and intuitiveness standpoint, places where our UI/UX could be improved and polished to be slicker, more visually appealing, and more premium feeling and just ultra high quality, like Stripe-level apps."""

[[palette]]
key = "apply_ubs"
label = "Apply UBS"
category = "Analysis & Review"
prompt = """
Read about the ubs tool in AGENTS.md. Now run UBS and investigate and fix literally every single UBS issue once you determine (after reasoned consideration and close inspection) that it's legit."""

# Coding & Development
[[palette]]
key = "fix_bug"
label = "Fix Bug"
category = "Coding & Development"
prompt = """
I want you to very carefully diagnose and then fix the root underlying cause of the bugs/errors shown here, but fix them FOR REAL, not a superficial "bandaid" fix! Here are the details:"""

[[palette]]
key = "create_tests"
label = "Create Tests"
category = "Coding & Development"
prompt = """
Do we have full unit test coverage without using mocks/fake stuff? What about complete e2e integration test scripts with great, detailed logging? If not, then create a comprehensive and granular set of beads for all this with tasks, subtasks, and dependency structure overlaid with detailed comments."""

[[palette]]
key = "leverage_tanstack_libraries"
label = "Leverage TanStack Libraries"
category = "Coding & Development"
prompt = """
Ok I want you to look through the ENTIRE project and look for areas where, if we leveraged one of the many TanStack libraries (e.g., query, table, forms, etc), we could make part of the code much better, simpler, more performant, more maintainable, elegant, shorter, more reliable, etc."""

[[palette]]
key = "build_ui_ux"
label = "Build UI/UX"
category = "Coding & Development"
prompt = """
I also want you to do a spectacular job building absolutely world-class UI/UX components, with an intense focus on making the most visually appealing, user-friendly, intuitive, slick, polished, "Stripe level" of quality UI/UX possible for this that leverages the good libraries that are already part of the project."""

# Documentation
[[palette]]
key = "complete_docusaurus_site"
label = "Complete Docusaurus Site"
category = "Documentation"
prompt = """
Now I need you to look through the existing documentation in our docusaurus site here and look for the (many, many) instances of functionality in our project that are not described or explained at all yet (or explained inadequately) in the docusaurus site, and then create and expand the documentation in the site to cover these in an exhaustive, intuitive, helpful, useful, pragmatic way. Don't just make a dump of methods, parameters, etc. Add actually well-written narrative explaining what the stuff does, how it is organized, etc. to help another developer understand how it all works so that they can usefully contribute to the system."""

[[palette]]
key = "improve_readme"
label = "Improve README"
category = "Documentation"
prompt = """
Be sure to check your agent mail and to promptly respond if needed to any messages, and also acknowledge any contact requests; make sure you know the names of all active agents using the MCP Agent Mail system."""

[[palette]]
key = "revise_readme"
label = "Revise README"
category = "Documentation"
prompt = """
We need to revise the README too for these changes (don't write about these as "changes" however, make it read like it was always like that, we don't have any users yet!)"""

[[palette]]
key = "add_missing_features_to_readme"
label = "Add Missing Features to README"
category = "Documentation"
prompt = """
What else can we put in there to make the README longer and more detailed about what we built, why it's useful, how it works, the algorithms/design principles used, etc. This is incremental NEW content, not replacement for what is there already."""

# Planning & Workflow
[[palette]]
key = "combine_plans_into_hybrid"
label = "Combine Plans Into Hybrid"
category = "Planning & Workflow"
prompt = """
I asked 3 competing LLMs to do the exact same thing and they came up with pretty different plans which you can read below. I want you to REALLY carefully analyze their plans with an open mind and be intellectually honest about what they did that's better than your plan. Then I want you to come up with the best possible revisions to your plan (you should simply update your existing document for your original plan with the revisions) that artfully and skillfully blends the "best of all worlds" to create a true, ultimate, superior hybrid version of the plan that best achieves our stated goals and will work the best in real-world practice to solve the problems we are facing and our overarching goals while ensuring the extreme success of the enterprise as best as possible; you should provide me with a complete series of git-diff style changes to your original plan to turn it into the new, enhanced, much longer and detailed plan that integrates the best of all the plans with every good idea included (you don't need to mention which ideas came from which models in the final revised enhanced plan):"""

[[palette]]
key = "improve_beads"
label = "Improve Beads"
category = "Planning & Workflow"
prompt = """
Check over each bead super carefully-- are you sure it makes sense? Is it optimal? Could we change anything to make the system work better for users? If so, revise the beads. It's a lot easier and faster to operate in "plan space" before we start implementing these things!"""

[[palette]]
key = "turn_plan_into_beads"
label = "Turn Plan Into Beads"
category = "Planning & Workflow"
prompt = """
OK so please take ALL of that and elaborate on it more and then create a comprehensive and granular set of beads for all this with tasks, subtasks, and dependency structure overlaid, with detailed comments so that the whole thing is totally self-contained and self-documenting (including relevant background, reasoning/justification, considerations, etc.-- anything we'd want our "future self" to know about the goals and intentions and thought process and how it serves the over-arching goals of the project.)"""

[[palette]]
key = "use_bv"
label = "Use BV"
category = "Planning & Workflow"
prompt = """
Use bv with the robot flags (see AGENTS.md for info on this) to find the most impactful bead(s) to work on next and then start on it. Remember to mark the beads appropriately and communicate with your fellow agents."""

[[palette]]
key = "next_bead"
label = "Next Bead"
category = "Planning & Workflow"
prompt = """
Pick the next bead you can actually do usefully now and start coding on it immediately; communicate what you're working on to your fellow agents and mark beads appropriately as you work. And respond to any agent mail messages you've received."""

[[palette]]
key = "work_on_your_beads"
label = "Work on Your Beads"
category = "Planning & Workflow"
prompt = """
OK, so start systematically and methodically and meticulously and diligently executing those remaining beads tasks that you created in the optimal logical order! Don't forget to mark beads as you work on them."""

[[palette]]
key = "do_all_of_it"
label = "Do All Of It"
category = "Planning & Workflow"
prompt = """
OK, please do ALL of that now. Track work via bd beads (no markdown TODO lists): create/claim/update/close beads as you go so nothing gets lost, and keep communicating via Agent Mail when you start/finish work."""

# Git & Operations
[[palette]]
key = "git_commit"
label = "Git Commit"
category = "Git & Operations"
prompt = """
Now, based on your knowledge of the project, commit all changed files now in a series of logically connected groupings with super detailed commit messages for each and then push. Take your time to do it right. Don't edit the code at all. Don't commit obviously ephemeral files. Use ultrathink."""

[[palette]]
key = "do_gh_flow"
label = "Do GH Flow"
category = "Git & Operations"
prompt = """
Do all the GitHub stuff: commit, deploy, create tag, bump version, release, monitor gh actions, compute checksums, etc."""

# Agent Coordination
[[palette]]
key = "default_new_agent"
label = "Default New Agent"
category = "Agent Coordination"
prompt = """
First read ALL of the AGENTS.md file and README.md file super carefully and understand ALL of both! Then use your code investigation agent mode to fully understand the code, and technical architecture and purpose of the project. Then register with MCP Agent Mail and introduce yourself to the other agents. Be sure to check your agent mail and to promptly respond if needed to any messages; then proceed meticulously with your next assigned beads, working on the tasks systematically and meticulously and tracking your progress via beads and agent mail messages. Don't get stuck in "communication purgatory" where nothing is getting done; be proactive about starting tasks that need to be done, but inform your fellow agents via messages when you do so and mark beads appropriately. When you're not sure what to do next, use the bv tool mentioned in AGENTS.md to prioritize the best beads to work on next; pick the next one that you can usefully work on and get started. Make sure to acknowledge all communication requests from other agents and that you are aware of all active agents and their names."""

[[palette]]
key = "check_and_respond_to_mail"
label = "Check and Respond to Mail"
category = "Agent Coordination"
prompt = """
Be sure to check your agent mail and to promptly respond if needed to any messages, and also acknowledge any contact requests; make sure you know the names of all active agents using the MCP Agent Mail system."""

[[palette]]
key = "introduce_to_fellow_agents"
label = "Introduce to Fellow Agents"
category = "Agent Coordination"
prompt = """
Before doing anything else, read ALL of AGENTS.md, then register with MCP Agent Mail and introduce yourself to the other agents."""

[[palette]]
key = "check_project_inbox"
label = "Check Project Inbox"
category = "Agent Coordination"
prompt = """
Check the project inbox for any new messages from other agents or the human overseer.
Run 'ntm mail inbox' to see the full list of messages."""

[[palette]]
key = "start_out_with_agent_mail"
label = "Start Out With Agent Mail"
category = "Agent Coordination"
prompt = """
Be sure to check your agent mail and to promptly respond if needed to any messages; then proceed meticulously with your next assigned beads, working on the tasks systematically and meticulously and tracking your progress via beads and agent mail messages. Don't get stuck in "communication purgatory" where nothing is getting done; be proactive about starting tasks that need to be done, but inform your fellow agents via messages when you do so and mark beads appropriately. When you're really not sure what to do, pick the next bead that you can usefully work on and get started. Make sure to acknowledge all communication requests from other agents and that you are aware of all active agents and their names. Use ultrathink."""

# Investigation
[[palette]]
key = "read_agents_and_investigate"
label = "Read Agents and Investigate"
category = "Investigation"
prompt = """
First read ALL of the AGENTS.md file and README.md file super carefully and understand ALL of both! Then use your code investigation agent mode to fully understand the code, and technical architecture and purpose of the project."""

[[palette]]
key = "reread_agents_md"
label = "Reread AGENTS.md"
category = "Investigation"
prompt = """
Reread AGENTS.md so it's still fresh in your mind."""

# Quick Commands
[[palette]]
key = "ultrathink"
label = "Ultrathink"
category = "Quick Commands"
prompt = """
Use ultrathink."""


[send]
# Disable CASS duplicate check by default (cass integration has issues)
cass_check = false
